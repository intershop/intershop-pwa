<ng-container *ngIf="(category$ | async) as category">

  <ish-breadcrumb [category]="category"></ish-breadcrumb>

  <!-- category with subcategories -->
  <ng-container *ngIf="category.hasChildren(); else productListing">
    <ish-category-page
      [category]="category"
    ></ish-category-page>
  </ng-container>

  <!-- category with products -->
  <ng-template #productListing>
    <ng-container *ngIf="category.hasOnlineProducts">
      <ish-family-page
        [category]="category"
        [products]="products$ | async"
        [totalItems]="totalItems$ | async"
        [viewType]="viewType$ | async"
        [sortBy]="sortBy$ | async"
        [sortKeys]="sortKeys$ | async"
        [loadingMore]="loadingMore$ | async"
        (viewTypeChange)="changeViewType($event)"
        (sortByChange)="changeSortBy($event)"
        (loadMore)="loadMore.emit()"
      ></ish-family-page>

      <ng-container *ngIf="!(filterMode$ | async)">
        <ng-container *ngIf="currentPage$ | async as currentPage">
          <a *ngIf="currentPage > 1" [style.display]="(endlessScrolling$ | async) ? 'none' : 'block'"
            [href]="'/category/' + category.uniqueId + '?page=' + (currentPage - 1)"
          >Load Previous Page</a>
          <a *ngIf="canRequestMore$ | async" [style.display]="(endlessScrolling$ | async) ? 'none' : 'block'"
            [href]="'/category/' + category.uniqueId + '?page=' + (currentPage + 1)"
          >Load Next Page</a>
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-template>

  <!-- empty category without subcategories and without products -->
  <ng-container *ngIf="!category.hasChildren() && !category.hasOnlineProducts">
    <!-- TODO: decide how to handle empty categories -->
    <h1>{{category.name}}</h1>
  </ng-container>

</ng-container>

<ish-loading *ngIf="categoryLoading$ | async"></ish-loading>
