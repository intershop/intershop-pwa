<ng-container *ngIf="(visible$ | async) && (editMode$ | async) as editMode">
  <ish-custom-fields-view *ngIf="collapsed" [fields]="customFields$ | async" />
  <button
    type="button"
    class="btn btn-link btn-link-action btn-collapse-link"
    [attr.aria-expanded]="!collapsed"
    aria-controls="basket-custom-fields-input"
    (click)="collapsed = !collapsed"
  >
    {{
      (editMode === 'edit'
        ? 'checkout.custom-fields.basket.edit.link.label'
        : 'checkout.custom-fields.basket.add.link.label'
      ) | translate
    }}
    <fa-icon [icon]="['fas', collapsed ? 'angle-down' : 'angle-up']" class="pl-2" />
  </button>

  <div id="basket-custom-fields-input" [ngbCollapse]="collapsed">
    <form [formGroup]="form" (ngSubmit)="submit()">
      <ish-custom-fields-formly [form]="form" [fields]="customFields$ | async" />

      <div class="row">
        <div class="col-12 offset-md-4 col-md-8">
          <button type="submit" class="btn btn-primary">
            {{
              (editMode === 'edit'
                ? 'checkout.custom-fields.save.button.label'
                : 'checkout.custom-fields.add.button.label'
              ) | translate
            }}
          </button>
          <button (click)="cancel()" type="button" class="btn btn-secondary">
            {{ 'checkout.custom-fields.cancel.button.label' | translate }}
          </button>
        </div>
      </div>
    </form>
  </div>
</ng-container>
