<ng-container *ngIf="!isMobileView; else mobileNavigation">
  <ul class="account-navigation list-unstyled" data-testing-id="myaccount-navigation">
    <ish-account-user-info></ish-account-user-info>
    <ng-container *ngFor="let item of navigationItems | keyvalue: unsorted; let first = first; let i = index">
      <ng-container *ishIsAuthorizedTo="item.value.permission || 'always'">
        <ng-container *ishHasNotRole="item.value.notRole">
          <li
            *ngIf="
              (item.value.feature || 'always' | ishFeature) && (item.value.serverSetting || 'always' | ishServerSetting)
            "
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: first }"
          >
            <ng-container *ngIf="item.value.children; else noChild">
              <a
                [attr.data-testing-id]="item.value.dataTestingId"
                (click)="item.value.isCollapsed = !item.value.isCollapsed"
                [attr.aria-expanded]="!item.value.isCollapsed"
                aria-controls="collapseExample"
                ><fa-icon [icon]="item.value.faIcon"></fa-icon>{{ item.value.localizationKey | translate }}</a
              >
            </ng-container>
            <ng-template #noChild>
              <a [routerLink]="item.key" [attr.data-testing-id]="item.value.dataTestingId">
                <fa-icon [icon]="item.value.faIcon"></fa-icon>{{ item.value.localizationKey | translate }}</a
              >
            </ng-template>
          </li>
          <div [ngbCollapse]="item.value.isCollapsed">
            <ul *ngIf="item.value.children" class="account-navigation list-unstyled">
              <ng-container *ngFor="let group of item.value.children | keyvalue: unsorted; let first = first">
                <ng-container *ngFor="let groupItem of group | keyvalue: unsorted; let first = first">
                  <ng-container *ngIf="groupItem.value.localizationKey">
                    <ng-container *ishIsAuthorizedTo="groupItem.value.permission || 'always'">
                      <ng-container *ishHasNotRole="groupItem.value.notRole">
                        <li
                          *ngIf="
                            (groupItem.value.feature || 'always' | ishFeature) &&
                            (groupItem.value.serverSetting || 'always' | ishServerSetting)
                          "
                          routerLinkActive="active"
                          [routerLinkActiveOptions]="{ exact: first }"
                        >
                          <a [routerLink]="group.key" [attr.data-testing-id]="item.value.dataTestingId">
                            {{ groupItem.value.localizationKey | translate }}</a
                          >
                        </li>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>
            </ul>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </ul>
</ng-container>

<ng-template #mobileNavigation>
  <select (change)="navigateTo($event.target)" class="form-control">
    <ng-container *ngFor="let item of navigationItems | keyvalue: unsorted">
      <ng-container *ishIsAuthorizedTo="item.value.permission || 'always'">
        <ng-container *ishHasNotRole="item.value.notRole">
          <ng-container *ngIf="item.value.children; else noChild">
            <optgroup
              *ngIf="
                (item.value.feature || 'always' | ishFeature) &&
                (item.value.serverSetting || 'always' | ishServerSetting)
              "
              [label]="item.value.localizationKey | translate"
            ></optgroup>
          </ng-container>
          <ng-template #noChild>
            <option
              *ngIf="
                (item.value.feature || 'always' | ishFeature) &&
                (item.value.serverSetting || 'always' | ishServerSetting)
              "
              [value]="item.key"
              [attr.selected]="isSelected(item.key)"
            >
              {{ item.value.localizationKey | translate }}
            </option>
          </ng-template>
          <ng-container *ngIf="item.value.children" class="account-navigation list-unstyled">
            <ng-container *ngFor="let group of item.value.children | keyvalue: unsorted; let first = first">
              <ng-container *ngFor="let groupItem of group | keyvalue: unsorted; let first = first">
                <ng-container *ngIf="groupItem.value.localizationKey">
                  <ng-container *ishIsAuthorizedTo="groupItem.value.permission || 'always'">
                    <ng-container *ishHasNotRole="groupItem.value.notRole">
                      <option
                        *ngIf="
                          (groupItem.value.feature || 'always' | ishFeature) &&
                          (groupItem.value.serverSetting || 'always' | ishServerSetting)
                        "
                        [value]="group.key"
                        [attr.selected]="isSelected(groupItem.value.link)"
                      >
                        {{ groupItem.value.localizationKey | translate }}
                      </option></ng-container
                    >
                  </ng-container>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </ng-container>
  </select>
</ng-template>
<ng-template #loadChild let-groupData="groupData" let-displayType="displayType"> </ng-template>
